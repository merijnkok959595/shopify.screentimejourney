customElements.get("dbtfy-upsell-popup")||customElements.define("dbtfy-upsell-popup",class extends HTMLElement{constructor(){super(),this.opener=this.querySelector("modal-opener"),this.blockSettings=[],this.querySelectorAll("[data-upsell-popup-block-settings]").forEach((e=>{this.blockSettings.push(JSON.parse(e.innerHTML))})),this.opened=!1,this.productInfo=document.querySelector("product-info"),this.productTrigger=!1}cartUpdateUnsubscriber=void 0;connectedCallback(){const e=this;document.addEventListener("DOMContentLoaded",(()=>{this.modal=new Debutify.modal({closeMethods:["overlay","button","escape"],size:this.dataset.modalWidth,closeIcon:"",selector:".dbtfy-upsell-popup___quick-view-wrapper",boxClass:["dbtfy-upsell-popup__modal-wrapper"],overlayClass:[],onOpen:function(){e.opened=!0},onClose:function(){e.opened=!1,"drawer"===Debutify.settings.cart_type?Debutify.showCartDrawer():"page"===Debutify.settings.cart_type&&(document.location.href=window.routes.cart_url)}})})),this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,this.cartUpdate.bind(this))}cartUpdate(e){if("product-form"===e.source){const t=e.cartData;let r=this.blockSettings.filter((e=>e.productTrigger===t.handle));if(r.length||(r=this.blockSettings.filter((e=>-1!==e.productHandles.indexOf(t.handle)))),r.length||(r=this.blockSettings.filter((e=>0===e.productHandles.length&&""===e.productTrigger))),!r.length)return void("page"==Debutify.settings.cart_type?window.location=window.routes.cart_url:this.opened&&(this.modal.close(),Debutify.showCartDrawer()));if(t.handle==r[0].productOffer)return void(this.opened&&(this.modal.close(),"page"!=Debutify.settings.cart_type?Debutify.showCartDrawer():document.location.href=window.routes.cart_url));Debutify.hideCartDrawer(),this.productTrigger=r[0],this.initModal(this.productTrigger)}}initModal(e){fetch("/products/"+e.productOffer+"?view=internal-upsell-popup").then((e=>e.text())).then((t=>{const r=new DOMParser;let o=r.parseFromString(t,"text/html").querySelector(".dbtfy-upsell-quick-view");if(!o)return;let s=e.buttonLabel,i=this.querySelector(".dbtfy-upsell-quick-view-button-icon").innerHTML;o.querySelector(".product-form__submit").innerHTML=i;let l=document.createElement("span");l.textContent=s,o.querySelector(".product-form__submit").appendChild(l);let n=this.dataset.upsellTitle.replaceAll("{product_title}",e.productTitle);o=Debutify.replaceVariables(o.innerHTML,{product_title:n,close_label:this.dataset.declineText,checkout_label:this.dataset.checkoutText,special_offer_label:e.offerText,description_label:r.parseFromString(e.description,"text/html").body.textContent,section_id:this.productInfo?.dataset.section}),this.modal.modalBox.querySelector(".dbtfy-upsell-popup___quick-view").innerHTML=o,setTimeout((()=>{this.modal.open(),this.modal.modalBox.querySelector(".dbtfy-upsell-quick-view-close").onclick=()=>{this.modal.close()}}),500)}))}}),customElements.get("dbtfy-upsell-popup-variant")||customElements.define("dbtfy-upsell-popup-variant",class extends HTMLElement{constructor(){super(),this.popup=document.querySelector("dbtfy-upsell-popup"),this.addEventListener("variant-selects:loaded",(({target:e})=>{this.preventDuplicatedIDs(e)})),this.variantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.variantChange,(e=>{this.querySelector('[type="submit"] span')&&(this.querySelector('[type="submit"] span').textContent=this.popup.productTrigger.buttonLabel)}))}preventDuplicatedIDs(e){e.dataset.section||(e.dataset.section=this.productInfo?.dataset.section);const t=e.dataset.section,r=t,o=`quickadd-${t}`;e.innerHTML=e.innerHTML.replaceAll(r,o),Array.from(e.attributes).forEach((t=>{t.value.includes(r)&&e.setAttribute(t.name,t.value.replace(r,o))})),e.dataset.originalSection=t}});