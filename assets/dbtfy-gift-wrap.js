customElements.get("dbtfy-gift-wrap")||customElements.define("dbtfy-gift-wrap",class extends HTMLElement{constructor(){super(),this.enableWidget=!0,this.data=Debutify.widgets["dbtfy-gift-wrap"],this.priceBox=this.querySelector(".price"),this.checkbox=this.querySelector(".dbtfy-gift-wrap__checkbox"),this.messageBox=this.querySelector(".dbtfy-gift-wrap__message"),this.messageInput=this.messageBox.querySelector(".text-area"),this.setupProductData(),this.enableWidget&&this.checkInCart(),this.enableWidget&&this.messageInput.addEventListener("input",this.updateMessage.bind(this)),"true"===localStorage.getItem("dbtfy_gift_wrap")&&(this.checkbox.checked=!0,this.messageBox.classList.remove("hidden"),this.querySelector("details").setAttribute("open",!0),setTimeout((()=>{localStorage.removeItem("dbtfy_gift_wrap")}),1e3))}async updateMessage(){const t={attributes:{gift_message:this.messageInput.value}};this.abortController&&this.abortController.abort(),this.abortController=new AbortController;try{await fetch(`${window.routes.cart_update_url}.js`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:this.abortController.signal})}catch(t){console.error("Error updating cart:",t)}}setupProductData(){if(!this.data.dbtfy_gift_wrap_product)return this.removeWidget(),!1;this.gift_product=this.data.dbtfy_gift_wrap_product}checkInCart(){var t=this;fetch(`/products/${this.gift_product}.js`).then((t=>t.json())).then((e=>{t.gift_product=e.variants[0],t.data.dbtfy_gift_wrap_show_price&&t.gift_product.price>0&&(t.priceBox.innerHTML=`(${Debutify.currency.symbol}${t.gift_product.price/100})`),Debutify.cart.items.forEach((e=>{e.variant_id==t.gift_product.id&&(t.checkbox.checked=!0,t.messageBox.classList.remove("hidden"),Debutify.cart.attributes.gift_message&&(t.messageInput.value=Debutify.cart.attributes.gift_message))}))})).catch((e=>{t.removeWidget()}))}removeWidget(){this.enableWidget=!1,this.remove()}connectedCallback(){this.checkbox.addEventListener("change",this.changeCheckbox.bind(this))}changeCheckbox(){this.checkbox.checked?this.submitGiftProduct():this.removeGiftProduct()}submitGiftProduct(){const t=Number(this.gift_product.id);Debutify.ajaxAddToCart({id:t,quantity:1}),this.messageBox.classList.remove("hidden"),localStorage.setItem("dbtfy_gift_wrap",!0)}removeGiftProduct(){let t=!1;document.querySelectorAll("cart-remove-button").forEach((e=>{t||e.querySelector("button").dataset.variantId==this.gift_product.id&&(t=!0,this.messageBox.classList.add("hidden"),e.click())}))}});