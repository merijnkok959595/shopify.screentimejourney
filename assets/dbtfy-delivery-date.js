customElements.get("dbtfy-cart-delivery-calendar")||customElements.define("dbtfy-cart-delivery-calendar",class extends HTMLElement{constructor(){super(),this.data=Debutify.widgets["dbtfy-delivery-date"],this.init()}init(){if(0===this.data.length)return void this.remove();this.data.dbtfy_delivery_date_required_checkout&&(Debutify.checkout["dbtfy-delivery-date"]=!1,checkoutButtonHandler());const{Calendar:t}=window.VanillaCalendarPro,e=this.formateDate(Debutify.cart.attributes.delivery_date);if(e&&"NaN-NaN-NaN"!==e){this.current_day=e;const t={year:"numeric",month:"long",day:"numeric"},a=new Date(this.current_day).toLocaleDateString("en-US",t);this.querySelector(".dbtfy-cart-delivery-calendar-show").textContent=a,this.data.dbtfy_delivery_date_required_checkout&&(Debutify.checkout["dbtfy-delivery-date"]=!0,checkoutButtonHandler())}else this.current_day=(new Date).toISOString().split("T")[0];this.day=(new Date).toISOString().split("T")[0];const a=this.data.dbtfy_delivery_date_exclude_days.split(",").map((t=>t.trim().toUpperCase())),r={SUN:0,MON:1,TUE:2,WED:3,THU:4,FRI:5,SAT:6},i=a.map((t=>r[t])),d={onClickDate:(t,e)=>{const a=e.target.ariaLabel;a&&this.handleDateSelection(a)},selectedTheme:"light",dateMin:this.day,dateToday:this.current_day,disableDates:this.getDisabledDates(i),displayDateMax:new Date((new Date).getFullYear()+100,11,31).toISOString().split("T")[0]};this._calendar=this.querySelector(".dbtfy-calendar"),this.calendar=new t(this._calendar,d),this.calendar.init()}getDisabledDates(t){const e=[],a=new Date,r=(new Date).getFullYear(),i=new Date(r+100,11,31);for(let r=a;r<=i;r.setDate(r.getDate()+1)){const a=r.getDay();if(t.includes(a)){const t=r.toISOString().split("T")[0];e.push(t)}}return e}handleDateSelection(t){this.querySelector(".dbtfy-cart-delivery-calendar-show").textContent=t,this.updateCartDeliveryDate(t),this.calendar.dateToday=this.formateDate(t)}formateDate(t){const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}async updateCartDeliveryDate(t){const e={attributes:{delivery_date:t}};try{const t=await fetch(`${window.routes.cart_update_url}.js`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items",cartData:a}),this.data.dbtfy_delivery_date_required_checkout&&(Debutify.checkout["dbtfy-delivery-date"]=!0,checkoutButtonHandler())}catch(t){console.error("Error updating cart:",t)}}});