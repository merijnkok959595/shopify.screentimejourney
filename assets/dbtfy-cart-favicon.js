customElements.get("dbtfy-cart-favicon")||customElements.define("dbtfy-cart-favicon",class extends HTMLElement{constructor(){super(),this.faviconUrl=this.dataset.cartFavicon,this.errorFaviconUrl=this.dataset.errorFavicon,this.errorDuration=1e3*parseInt(this.dataset.errorDuration),this.badgeStyle=this.dataset.badgeStyle,this.badgePosition=this.dataset.badgePosition,this.badgeBgColor=this.dataset.badgeBgColor,this.badgeTextColor=this.dataset.badgeTextColor,this.currentItemCount=0}connectedCallback(){this.updateBadgeOnLoad(),this.faviconEvent=subscribe(PUB_SUB_EVENTS.cartUpdate,(t=>{setTimeout((()=>{this.updateBadgeOnCartChange(),0==Debutify.cart.item_count&&this.removeFavicon()}),500)})),subscribe(PUB_SUB_EVENTS.cartError,(()=>{this.setErrorFavicon()}))}updateBadgeOnLoad(){if("undefined"!=typeof Debutify&&Debutify.cart){const t=Debutify.cart.item_count;this.currentItemCount=t,this.checkAndUpdateBadge()}}updateBadgeOnCartChange(){if("undefined"!=typeof Debutify&&Debutify.cart){const t=Debutify.cart.item_count;t!==this.currentItemCount&&(this.currentItemCount=t,this.checkAndUpdateBadge())}}updateCount(){let t,e=this.currentItemCount;return Debutify.cart.items.forEach((t=>{t.properties&&"false"==t.properties._showProduct&&(e-=1)})),t=e,t}checkAndUpdateBadge(){if("undefined"!=typeof Debutify&&Debutify.cart){Debutify.cart.item_count>0?this.setFaviconWithBadge(this.updateCount()):this.removeFavicon()}}setFaviconWithBadge(t){const e=document.createElement("canvas"),a=new Image;a.src=this.faviconUrl,a.onload=()=>{const i=32;e.width=i,e.height=i;const r=e.getContext("2d");r.drawImage(a,0,0,i,i),r.fillStyle=this.badgeBgColor;const o=16;let n,s;switch(this.badgePosition){case"top-left":n=4,s=12;break;case"bottom-right":default:n=12,s=4;break;case"bottom-left":n=4,s=4;break;case"top-right":n=12,s=12}"square"===this.badgeStyle?(r.beginPath(),r.arc(n+8,s+8,8,0,2*Math.PI),r.fill()):r.fillRect(n,s,o,o),r.fillStyle=this.badgeTextColor,r.font=`bold ${o/1.5}px Arial`,r.textAlign="center",r.textBaseline="middle",r.fillText(t,n+8,s+8);this.getOrCreateFavicon().href=e.toDataURL("image/png")}}setErrorFavicon(){const t=this.getOrCreateFavicon();t.href=this.errorFaviconUrl,setTimeout((()=>{t.href=this.faviconUrl}),this.errorDuration)}removeFavicon(){const t=this.getOrCreateFavicon(),e=Debutify.settings.favicon;t.href=e}getOrCreateFavicon(){let t=document.querySelector("link[rel='icon']");return t||(t=document.createElement("link"),t.rel="icon",t.type="image/png",document.head.appendChild(t)),t}});