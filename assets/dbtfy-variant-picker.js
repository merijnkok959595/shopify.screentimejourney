customElements.get("dbtfy-variant-picker")||customElements.define("dbtfy-variant-picker",class extends HTMLElement{constructor(){super(),this.id=this.dataset.id,this.url=this.dataset.url,this.pickerWrapper=this.querySelector(".dbtfy-variant-picker__picker"),this.select=this.querySelector(".dbtfy-variant-picker__selector"),this.optionUnavailable=this.dataset.optionUnavailable,this.picker=void 0,this.testMode=Shopify.designMode,this.selectEvent=null}disconnectedCallback(){this.testMode&&this.selectEvent()}connectedCallback(){this.testMode&&(this.selectEvent=subscribe(PUB_SUB_EVENTS.shopifyEventBlockSelect,(e=>{e.detail.blockId.includes("product_variant_picker")&&this.init()}))),this.init()}init(){this.select&&(""===this.pickerWrapper.innerHTML.trim()?this.fetchVariantPicker():this.addEventChangePicker())}async fetchVariantPicker(){try{let e=await Debutify.fetchProductMarkup(this.url);if(!e)return console.error("HTTP-Error: "+res.status),null;{const t=(new DOMParser).parseFromString(e,"text/html").querySelector("variant-selects"),i=t.dataset.section;t.innerHTML=t.innerHTML.replaceAll(i,this.id).replaceAll("disabled","").replaceAll(this.optionUnavailable,""),t.querySelectorAll("fieldset").forEach(((e,t)=>{e.querySelectorAll("input, select").forEach((e=>{e.setAttribute("name",`${this.id}-${t+1}`)}))})),this.pickerWrapper.innerHTML="",this.pickerWrapper.appendChild(t),this.addEventChangePicker()}}catch(e){return console.error("Error: "+e),null}}addEventChangePicker(){this.picker=this.pickerWrapper.querySelector("variant-selects"),this.picker?.querySelectorAll("label").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.closest("label").previousElementSibling;t.disabled||(t.checked=!0,this.changePicker())}))})),this.picker?.querySelectorAll(".select__select").forEach((e=>{e.addEventListener("change",(e=>{e.preventDefault(),this.changePicker()}))}))}changePicker(){const e=Array.from(this.picker.querySelectorAll("input:checked, .select__select")).map((e=>e.value)).join(" / ");this.select.value=this.select.querySelector(`option[data-title="${e}"]`).value,this.select.dispatchEvent(new Event("change"))}});