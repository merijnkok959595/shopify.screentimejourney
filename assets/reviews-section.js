customElements.get("star-rating")||customElements.define("star-rating",class extends HTMLElement{constructor(){if(super(),this.rating=this.dataset.rating,this.disableColor=this.dataset.disableColor,isNaN(this.rating))return!1;this.rating=parseInt(this.rating)+1,this.init()}init(){let e=this.querySelectorAll("svg:nth-child(n+"+this.rating+")");e&&e.forEach((e=>{this.disableColor?e.style.fill=this.disableColor:e.classList.add("empty-star-svg")}))}}),customElements.get("review-updownvote")||customElements.define("review-updownvote",class extends HTMLElement{constructor(){super(),this.reviewId=this.closest(".review_item").dataset.reviewId,this.reviewId?(this.upvote=this.querySelector("review-upvote"),this.downvote=this.querySelector("review-downvote"),this.upvoteCounter=this.upvote.querySelector(".counter"),this.downvoteCounter=this.downvote.querySelector(".counter"),localStorage.getItem(this.reviewId+"-upvote")&&this.upvote.querySelector("i").classList.add("filled"),localStorage.getItem(this.reviewId+"-downvote")&&this.downvote.querySelector("i").classList.add("filled"),this.apiURL=Debutify.reviewAPIPrefix+"reviews/review-vote"):this.remove()}connectedCallback(){this.upvote.addEventListener("click",this.upvoteReview.bind(this)),this.downvote.addEventListener("click",this.downvoteReview.bind(this))}async upvoteReview(){await this.voteReview(this.reviewId,"up",this.upvote),localStorage.getItem(this.reviewId+"-downvote")?(localStorage.removeItem(this.reviewId+"-downvote"),this.downvote.querySelector("i").classList.remove("filled")):(localStorage.setItem(this.reviewId+"-upvote",1),this.upvote.querySelector("i").classList.toggle("filled"))}async downvoteReview(){await this.voteReview(this.reviewId,"down",this.downvote),localStorage.getItem(this.reviewId+"-upvote")?(localStorage.removeItem(this.reviewId+"-upvote"),this.upvote.querySelector("i").classList.remove("filled")):(localStorage.setItem(this.reviewId+"-downvote",1),this.downvote.querySelector("i").classList.toggle("filled"))}async voteReview(e,t,i){try{i.disabled=!0;const r=await fetch(this.apiURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reviewId:e,voteType:t})});if(!r.ok)throw new Error("Failed to register vote.");const s=await r.json();if(s.success&&s.data.length>0){const t=s.data.find((t=>t.reviewId===e));t&&(this.upvoteCounter.textContent=t.upvote,this.downvoteCounter.textContent=t.downvote)}i.disabled=!1}catch(e){i.disabled=!1,console.error("Error voting review:",e),alert("An error occurred. Please try again.")}}}),customElements.get("dtm-review")||customElements.define("dtm-review",class extends HTMLElement{constructor(){super(),this.reviewAPIPrefix=Debutify.reviewAPIPrefix,this.reviewAPIs={customerReviews:this.reviewAPIPrefix+"customer-reviews",addReview:this.reviewAPIPrefix+"reviews",uploadMedia:this.reviewAPIPrefix+"reviews/upload-media"},this.itemTemplate=this.querySelector("#review-item-template");const e=this.itemTemplate.dataset;this.sliderEnabled=e.sliderEnabled,this.desktopCol=parseInt(e.sliderDesktopCol,10),this.mobileCol=parseInt(e.sliderMobileCol,10),this.sliderStyle=e.sliderStyle,this.enableReviewerPhoto="true"===e.reviewerPhoto,this.dateformat=e.dateFormat,this.showImages="true"===e.showAttachedImages,this.showVideos="true"===e.showAttachedVideos,this.mediaAspectRatio=e.aspectRatio,"list"==this.sliderStyle&&(this.desktopCol=1,this.mobileCol=1),this.reviewNotFound=this.querySelector("#review-not-found"),this.reviewContainer=this.querySelector(".review-container"),this.sortBySelector=this.querySelector("#sort-reviews"),this.perPageSelector=this.querySelector("#per-page"),this.mediaOnlySelector=this.querySelector("#reviews-with-media"),this.ratingProgress=this.querySelector(".rating-progress-col"),this.writeReviewButton=this.querySelector(".write-review-button"),this.reviewForm=this.querySelector("#reviewForm"),this.reviewForm.addEventListener("submit",this.submitReview.bind(this))}connectedCallback(){this.setupReview(),this.writeReviewButton&&this.writeReviewButton.addEventListener("click",(()=>{this.modal.open()})),void 0!==Debutify.modal?this.loadModel():document.addEventListener("DOMContentLoaded",(()=>{this.loadModel()})),this.perPageSelector.addEventListener("change",this.setupReview.bind(this)),this.sortBySelector.addEventListener("change",this.setupReview.bind(this)),this.mediaOnlySelector.addEventListener("change",this.setupReview.bind(this))}sliderInit(){let e;this.classList.contains("cloned")&&"false"==document.querySelector("dbtfy-product-tab").dataset.block&&(this.clonedDesktopCol=2),this.querySelectorAll(".review-media-slider").forEach((e=>{e.querySelectorAll("li").length>0&&new Splide(e,{perPage:2,perMove:1,gap:"1em",drag:!1,pagination:!1,classes:{arrow:"slider-button splide__arrow"}}).mount()})),"none"!==this.sliderEnabled?(e="desktop"===this.sliderEnabled?{perPage:this.clonedDesktopCol||this.desktopCol,perMove:1,gap:"1em",drag:document.querySelectorAll("#review-slider .review_item").length>this.clonedDesktopCol||this.desktopCol,breakpoints:{750:{destroy:!0}},classes:{arrow:"slider-button splide__arrow"}}:"mobile"===this.sliderEnabled?{perPage:this.mobileCol,perMove:1,gap:"1em",mediaQuery:"min",drag:document.querySelectorAll("#review-slider .review_item").length>this.clonedDesktopCol||this.desktopCol,breakpoints:{750:{perPage:this.mobileCol,perMove:1,destroy:!0,drag:document.querySelectorAll("#review-slider .review_item").length>this.mobileCol}},classes:{arrow:"slider-button splide__arrow"}}:{perPage:this.clonedDesktopCol||this.desktopCol,perMove:1,drag:document.querySelectorAll("#review-slider .review_item").length>this.clonedDesktopCol||this.desktopCol,gap:"1em",pagination:!1,breakpoints:{750:{perPage:this.mobileCol,perMove:1,drag:document.querySelectorAll("#review-slider .review_item").length>this.mobileCol}},classes:{arrow:"slider-button splide__arrow"}},new Splide("#review-slider",e).mount()):this.querySelector("#review-slider").classList.remove("splide")}loadModel(){const e=this;this.modal=new Debutify.modal({closeMethods:["overlay","button","escape"],size:"small",closeIcon:"",selector:"review-form-modal",boxClass:["inner-spacing"],overlayClass:["review--form"],onOpen:function(){e.dropzone=this.modal.querySelector(".dropbox"),e.fileInput=this.modal.querySelector("#review-media"),e.mediaLimit=this.modal.querySelector(".media-limit"),e.mediaRequired=this.modal.querySelector(".media-required"),e.reviewError=this.modal.querySelector(".review-form-error"),e.previewContainer=this.modal.querySelector("#preview-container"),e.submitButton=this.modal.querySelector(".submit-btn"),e.reviewWrapper=this.modal.querySelector(".review-wrapper"),e.thankYouMessageWrapper=this.modal.querySelector(".review-thank-you-message-wrapper"),e.setupDropbox(),this.modal.querySelector("#reviewForm").reset(),e.previewContainer&&(e.previewContainer.innerHTML="")},onClose:function(){e.reviewWrapper.classList.remove("hidden"),e.thankYouMessageWrapper.classList.add("hidden"),e.reviewError.classList.add("hidden")}}),this.modal.modalBox.querySelector("#reviewForm")?.addEventListener("submit",e.submitReview.bind(e)),this.cancelBtn=this.modal.modalBox.querySelector(".cancel-btn"),this.cancelBtn.addEventListener("click",(()=>{this.modal.close()}))}setupDropbox(){const e=this.dropzone;null!==e&&(["dragenter","dragover","dragleave","drop"].forEach((t=>{e.addEventListener(t,(e=>e.preventDefault()),!1)})),["dragenter","dragover"].forEach((t=>{e.addEventListener(t,(()=>e.classList.add("highlight")),!1)})),["dragleave","drop"].forEach((t=>{e.addEventListener(t,(()=>e.classList.remove("highlight")),!1)})),e.addEventListener("click",(()=>this.fileInput.click())),e.addEventListener("drop",this.handleFiles.bind(this)),this.fileInput.addEventListener("change",this.handleFiles.bind(this)))}async handleFiles(e){let t;if(e.dataTransfer?t=e.dataTransfer.files:e.target&&(t=e.target.files),!t)return;this.previewContainer.innerHTML="";let i=new FormData;i.append("shopName",Debutify.permanent_domain);let r=0;if(t&&t.length>0){if(Array.from(t).forEach((e=>{r+=e.size})),r>5242880)return void this.mediaLimit.classList.remove("hidden");this.mediaLimit.classList.add("hidden")}Array.from(t).forEach((e=>{if(e.type.startsWith("image/"))this.previewImage(e);else{if(!e.type.startsWith("video/"))return void alert("Only images and videos are allowed.");this.previewVideo(e)}i.append("medias",e,e.name)})),i.has("medias")&&(this.previewContainer.classList.add("hidden"),this.submitButton.classList.add("loading"),this.submitButton.querySelector(".loading__spinner").classList.remove("hidden"),this.submitButton.disabled=!0,await this.uploadMedia(i))}previewImage(e){const t=new FileReader;t.onload=e=>{const t=document.createElement("img");t.src=e.target.result,t.classList.add("preview-image"),this.previewContainer.appendChild(t)},t.readAsDataURL(e)}previewVideo(e){const t=new FileReader;t.onload=e=>{const t=document.createElement("video");t.src=e.target.result,t.controls=!0,t.classList.add("preview-video"),this.previewContainer.appendChild(t)},t.readAsDataURL(e)}async uploadMedia(e){try{const t=await fetch(this.reviewAPIs.uploadMedia,{method:"POST",body:e}),i=await t.json();if(!(i.success&&i.data.length>0))return console.error("Upload error:",i.error),[];this.mediaRequired?.classList.add("hidden"),this.previewContainer.classList.remove("hidden"),this.submitButton.classList.remove("loading"),this.submitButton.querySelector(".loading__spinner").classList.add("hidden"),this.submitButton.disabled=!1,this.mediaUrls=i.data}catch(e){return console.error("Error uploading media:",e),[]}}setupReview(e=1){"object"==typeof e&&(e=1);const t=new URLSearchParams({reviewType:"product",productId:this.dataset.productId,sortBy:this.sortBySelector.value,shopName:Debutify.permanent_domain,limit:this.perPageSelector.value,page:e,mediaOnly:this.mediaOnlySelector.checked}).toString(),i=`${this.reviewAPIs.customerReviews}?${t}`;fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((t=>{const i=t.data;let r=0,s="";if(0==t.success||0==i.reviews.length?this.querySelector("#dbtfy-review-scroll").classList.add("hidden"):(i.reviews?.forEach((e=>{var t=r++;s+=this.renderReview(e,t)})),i.pagination.currentPage<i.pagination.lastPage?(this.querySelector("#dbtfy-review-scroll").classList.remove("hidden","loading"),this.querySelector("#dbtfy-review-scroll").onclick=()=>{this.setupReview(i.pagination.currentPage+1),this.querySelector(".loading__spinner").classList.remove("hidden"),this.querySelector("#dbtfy-review-scroll").classList.add("loading")}):this.querySelector("#dbtfy-review-scroll").classList.add("hidden")),0==t.success||0===i.reviews.length){const e=this.reviewNotFound.innerHTML,t=this.reviewNotFound.content.cloneNode(!0),i=document.createElement("div");i.appendChild(t),i.querySelector(".review-not-found-wrapper").innerHTML=e,this.querySelector(".reviewNotFound").innerHTML="",this.querySelector(".reviewNotFound").insertAdjacentHTML("beforeend",i.innerHTML),this.querySelector(".reviewsData").innerHTML=""}else{this.querySelector(".reviewNotFound").innerHTML="";const t=this.querySelector("#review-wrapper-template").content.cloneNode(!0),r=document.createElement("div");r.appendChild(t),r.querySelector(".review-container").innerHTML=s,1==e?(this.querySelector(".reviewsData").innerHTML="",this.querySelector(".reviewsData").insertAdjacentHTML("beforeend",r.innerHTML)):"none"==this.sliderEnabled?this.querySelector(".reviewsData ul").insertAdjacentHTML("beforeend",s):this.querySelector(".reviewsData ul").insertAdjacentHTML("afterbegin",s),this.renderProgress(i.productRatings,i.pagination.totalReviews)}this.querySelector(".loading__spinner").classList.add("hidden");const o=document.querySelector(".product-tab-content .review-badge dtm-review-tab");o&&!this.classList.contains("cloned")&&(this.classList.add("cloned"),o.innerHTML="",o.appendChild(this))}))}formatDate(e){const t=new Date(e),i=String(t.getUTCDate()).padStart(2,"0"),r=String(t.getUTCMonth()+1).padStart(2,"0"),s=t.getUTCFullYear();return this.dateformat.replace("dd",i).replace("mm",r).replace("yyyy",s)}renderProgress(e,t){if(!e)return;const i=t||1;this.ratingProgress.querySelectorAll(".progress-section").forEach((t=>{const r=t.dataset.rating,s=t.querySelector(".verified-progress"),o=t.querySelector(".star_count");switch(r){case"1":s.value=""+e.one_star/i*100,o.setAttribute("data-review",e.one_star);break;case"2":s.value=""+e.two_stars/i*100,o.setAttribute("data-review",e.two_stars);break;case"3":s.value=""+e.three_stars/i*100,o.setAttribute("data-review",e.three_stars);break;case"4":s.value=""+e.four_stars/i*100,o.setAttribute("data-review",e.four_stars);break;case"5":s.value=""+e.five_stars/i*100,o.setAttribute("data-review",e.five_stars)}})),this.querySelector(".review_based_on_text").setAttribute("data-review",t),this.querySelector(".rating-value").setAttribute("data-review",e.overallRating),this.querySelector(".rating-score .stars i").setAttribute("data-star",e.overallRating),this.querySelector(".review-counter").setAttribute("data-review",e.verifiedPurchases),t>0&&this.sliderInit()}renderReview(e,t){const i=this.itemTemplate.content.cloneNode(!0),r=document.createElement("div");r.appendChild(i),e.attachments=e.attachments||[];let s="",o=0;e.attachments.forEach((e=>{var t=o++;this.showImages&&"image"==e.fileType?s+=`<li id='Slide-${t}' class="splide__slide ratio image--ratio"><div class="media media-${this.mediaAspectRatio}"><img src="${e.filePath}" alt="review-image" class="review-image" /></div></li>`:this.showVideos&&(s+=`<li id="Slide-${t}" class="splide__slide ratio image--ratio"\n            ><div class="media media-${this.mediaAspectRatio}"><video controls>\n            <source src="${e.filePath}" type="video/mp4">\n            Your browser does not support the video tag.\n          </video></div></li>`)}));let a=Debutify.replaceVariables(r.innerHTML,{id:t,review_id:e.id||"",title:e.reviewTitle||"",body:e.reviewContent||"",rating:e.rating,reviewDate:this.formatDate(e.createdAt),reviewerName:e.reviewerName||"",avatar:e.reviewerName?e.reviewerName.charAt(0).toUpperCase():"A",image_video:s,upvote_counter:e.upvote||0,downvote_counter:e.downvote||0});return a=e.comment?Debutify.replaceVariables(a,{replier_avatar:e.comment.replierName?e.comment.replierName.charAt(0).toUpperCase():"A",replier_name:e.comment.replierName||"",replier_message:e.comment.comment||"",replier_block:""}):Debutify.replaceVariables(a,{replier_block:"hidden"}),a}submitReview(e){e.preventDefault();const t=new FormData(e.target);t.append("shopName",Debutify.permanent_domain),t.append("productId",this.dataset.productId),this.submitButton.classList.add("loading"),this.submitButton.querySelector(".loading__spinner").classList.remove("hidden"),this.submitButton.disabled=!0,this.mediaRequired&&(this.mediaUrls?(this.mediaUrls.forEach((e=>{t.append("mediaUrls[]",e)})),this.mediaRequired.classList.add("hidden")):this.mediaRequired.classList.remove("hidden")),fetch(this.reviewAPIs.addReview,{method:"POST",body:t}).then((e=>e.json())).then((e=>{if(this.submitButton.classList.remove("loading"),this.submitButton.querySelector(".loading__spinner").classList.add("hidden"),this.submitButton.disabled=!1,e.success)this.reviewWrapper.classList.add("hidden"),this.thankYouMessageWrapper.classList.remove("hidden"),this.setupReview();else if(!e.success)if(this.reviewError.classList.remove("hidden"),e.error.data){if(e.error.data.length>0){let t="";e.error.data.forEach((e=>{t+=e.message+"<br>"})),this.reviewError.innerHTML=t.trim()}}else this.reviewError.textContent=e.error.message}))}});