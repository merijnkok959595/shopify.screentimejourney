customElements.get("dbtfy-shipping-calculator")||customElements.define("dbtfy-shipping-calculator",class extends HTMLElement{constructor(){super(),this.data=Debutify.widgets["dbtfy-shipping-calculator"],this.countryId=this.dataset.countryId,this.provinceId=this.dataset.provinceId,this.provinceWrapperId=this.dataset.provinceWrapper,this.countryWrapper=this.querySelector("#dbtfy-shipping-calculator-country-wrapper"),this.country=this.countryWrapper.querySelector(`#${this.countryId}`),this.provinceWrapper=this.querySelector(`#${this.provinceWrapperId}`),this.province=this.provinceWrapper.querySelector(`#${this.provinceId}`),this.zip=this.querySelector("#dbtfy-shipping-calculator-zip"),this.alert=this.querySelector("#dbtfy-shipping-calculator-alert"),this.btn=this.querySelector("button"),0!==this.data.length?(this.initCommonJsScript(),this.btn.addEventListener("click",this.onSubmit.bind(this)),this.shippingResponse=localStorage.getItem("shippingResponse")):this.remove()}async initCommonJsScript(){const t=document.createElement("script");t.src=this.dataset.shopifyCommonJs,document.head.appendChild(t),await new Promise((t=>setTimeout(t,1e3))),new window.Shopify.CountryProvinceSelector(this.countryId,this.provinceId,{hideElement:this.provinceWrapperId}),this.country.options[0].textContent=this.country.getAttribute("aria-label");const e=this;this.country.addEventListener("change",(function(t){let i=localStorage.getItem("shippingProvince")??e.dataset.customerProvince;i.length&&(e.province.value=i)})),this.insertCustomerData(),this.shippingResponse&&this.updateAlertContent(this.shippingResponse,"alert-success")}insertCustomerData(){const t=localStorage.getItem("shippingCountry")??this.dataset.customerCountry,e=localStorage.getItem("shippingProvince")??this.dataset.customerProvince,i=localStorage.getItem("shippingZip")??this.dataset.customerZip;t.length?(this.country.value=t,this.country.dispatchEvent(new CustomEvent("change")),e.length&&(this.province.value=e),i.length&&(this.zip.value=i)):fetch("https://api-bdc.io/data/reverse-geocode-client?localityLanguage=en").then((t=>t.json())).then((t=>{this.country.value=t.countryName,this.country.dispatchEvent(new CustomEvent("change")),this.province.value=t.principalSubdivision,localStorage.setItem("shippingCountry",this.country.value),localStorage.setItem("shippingProvince",this.province.value),localStorage.removeItem("shippingZip")}))}updateAlertClasses(t){this.alert.classList.remove("alert-danger","alert-warning","alert-success"),this.alert.classList.add(t)}updateAlertContent(t,e){const i=`\n            <ul>\n              ${t}\n            </ul>\n          `;e.includes("success")?localStorage.setItem("shippingResponse",t):localStorage.removeItem("shippingResponse"),this.alert.innerHTML=i,this.updateAlertClasses(e),this.alert.removeAttribute("hidden")}async onSubmit(){localStorage.setItem("shippingCountry",this.country.value),localStorage.setItem("shippingProvince",this.province.value),localStorage.setItem("shippingZip",this.zip.value),this.btn.classList.add("loading"),this.btn.querySelector(".loading__spinner").classList.remove("hidden");const t=await fetch(`/cart/prepare_shipping_rates.json?shipping_address[zip]=${this.zip.value}&shipping_address[country]=${this.country.value}&shipping_address[province]=${this.province.value}`,{method:"POST"});if(t.ok){const t=await fetch(`/cart/async_shipping_rates.json?shipping_address[zip]=${this.zip.value}&shipping_address[country]=${this.country.value}&shipping_address[province]=${this.province.value}`),e=await t.json();if(e.shipping_rates.length){const t=e.shipping_rates.map((({presentment_name:t,price:e,currency:i})=>`\n                <li>\n                  <strong>${t}</strong>: ${e} ${i}\n                </li>\n              `)).join("");this.updateAlertContent(t,"alert-success")}else this.updateAlertContent(this.data.text_no_results,"alert-warning")}else{const e=await t.json(),i=Object.entries(e).map((([t,e])=>`\n                <li>\n                  ${e.toString()}\n                </li>\n                `)).join("");this.updateAlertContent(i,"alert-danger")}this.btn.classList.remove("loading"),this.btn.querySelector(".loading__spinner").classList.add("hidden")}});